platform: x64

environment:
  nodejs_version: "8"

# Install scripts. (runs after repo cloning)
install:
  # Get the latest stable version of Node.js or io.js
  - ps: Install-Product node $env:nodejs_version x64
  - choco install redis-64
  - redis-server --service-install
  - redis-server --service-start
  # install modules
  - npm install

# Post-install test scripts.
test_script:
  # Output useful info for debugging.
  - node --version
  - npm --version
  # Show home directory
  - node -p "os.homedir()"
  # Run tests
  - npm test

build_script:
  # Build Windows binary
  - npm run package

deploy:
    release: zmine-v$(appveyor_build_version)
    description: 'Automatic Build'
    provider: GitHub
    auth_token:
        secure: QbUdvt8xBGWxhuqNsGX/cSHNxQz2Zpn6tnhKlMX/KLT3i2dwPP2LVJiPiTxh7b+I
    artifact: zmine-win32-x64/*
    draft: false
    prerelease: true
    on:
        branch: master                 # release from master branch only
        appveyor_repo_tag: false       # deploy on tag push only

# Don't actually build.
#build: off
